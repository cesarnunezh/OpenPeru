# Use Python slim image as base
FROM python:3.11-slim

# Set environment variables
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1
ENV PYTHONPATH=/estecon
ENV PATH="/root/.local/bin:$PATH"

# Set working directory
WORKDIR /estecon

# Install curl for uv installation
RUN apt-get update && \
    apt-get install -y --no-install-recommends curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Copy dependency files first for better caching
COPY pyproject.toml uv.lock ./

# Install uv and dependencies
RUN curl -LsSf https://astral.sh/uv/install.sh | sh -s -- && \
    uv --version && \
    uv sync

# Copy application code and tests
COPY . .

# Run pytest as the default command using uv
CMD ["uv", "run", "pytest", "estecon/tests"] 